---
title: "R Notebook"
output:
  html_notebook: default
  pdf_document: default
---

First check if needed packages are installed, if so go on. Else install the packages.

```{r}
if (is.element('limma', installed.packages()[,1]) == FALSE) { 
install.packages('limma') }

if (is.element('edgeR', installed.packages()[,1]) == FALSE) { 
install.packages('edgeR') }

library('limma','edgeR')
```


Here we get the patch to the working directory on your computer. From here we can easily open the files in the directory.

```{r}
wd <- getwd()
WCFS1_path <- file.path(wd, "WCFS1_anno.txt")
RNA_seq_counts_path <- file.path(wd, "RNA-Seq-counts.txt")
```

Here we open the files and set them in an dataset.

```{r}
anno <- read.delim(header=TRUE, file= file.path(WCFS1_path), skip=1)
counts <- read.delim(header=TRUE, file= file.path(RNA_seq_counts_path))
```

The counts dataset consist genes with count data. The anno dataset consists of annotation data for these genes.
First, we will look at the count dataset; this contains 9 columns.

1. ID
2. WCFS1.glc.1
3. WCFS1.glc.2
4. WCFS1.rib.1
5. WCFS1.rib.2
6. NC8.glc.1
7. NC8.glc.2
8. NC8.rib.1
9. NC8.rib.2

ID identifies the read, WCFS1 & NC8 are genens, glc & rib are glucose and ribose respectfully and 1 & 2 are expiriments.

To quickly see which expiriments correspond to wich gene and what feeding ground is used see the table below:  

_             | WCFS1.glc.1 | WCFS1.glc.2 | WCFS1.rib.1 | WCFS1.rib.2 | NC8.glc.1 | NC8.glc.2 | NC8.rib.1 | NC8.rib.2
------------- | ----------- | ----------- | ----------- | ----------- | --------- | --------- | --------- | ---------
WCFS1 glucose | 1           | 1           | 0           | 0           | 0         | 0         | 0         | 0
WCFS1 ribose  | 0           | 0           | 1           | 1           | 0         | 0         | 0         | 0
NC8 glucose   | 0           | 0           | 0           | 0           | 1         | 1         | 0         | 0
NC8 ribose    | 0           | 0           | 0           | 0           | 0         | 0         | 1         | 1


Interesting comments:  
*Or alternatively rpkm() to normalize by gene length as well. cpm() gives expression values normalized by library size and TMM. rpkm() gives expression values normalized by library size, TMM and gene length.*

https://mmg434.readthedocs.io/en/latest/dayfivemod.html

To prep the data we first need to get them in specific groups. To do this we group them.
```{r}
all = cbind(counts[,"WCFS1.glc.1"], counts[,"WCFS1.glc.2"],counts[,"WCFS1.rib.1"],counts[,"WCFS1.rib.2"],counts[,"NC8.glc.1"], counts[,"NC8.glc.2"],counts[,"NC8.rib.1"],counts[,"NC8.rib.2"])  
  
WCFS1all = c(counts[,"WCFS1.glc.1"], counts[,"WCFS1.glc.2"],counts[,"WCFS1.rib.1"],counts[,"WCFS1.rib.2"])
NC8all = c(counts[,"NC8.glc.1"], counts[,"NC8.glc.2"],counts[,"NC8.rib.1"],counts[,"NC8.rib.2"])
```




Before we can normalize the de data to use for statistic tests we need to filter out low counts that can possibly lead to a skewing of the data.

```{r}
group <- c(1,1,1,1,2,2,2,2)
y <- DGEList(counts=all, group=group)
keep <- rowSums(cpm(y)>2) >= 4
y <- y[keep,]

y$samples$lib.size <- colSums(y$counts)
y <- calcNormFactors(y, method = 'TMM')
y$samples
plotMDS(y)
```


```{r}
y <- estimateCommonDisp(y, verbose=TRUE)
y <- estimateTagwiseDisp(y)
plotBCV(y)
```
```{r}
res <- exactTest(y)
fdr <- p.adjust(res$table$PValue, method="BH")
cpmres <- cpm(y)[rownames(res),]
summary(de <- decideTestsDGE(res))
```



```{r}


head(anno)
head(counts)

# take a slice from df and change colnames
anno <- anno [,c("ORF","name")]
colnames(anno) <- c("ID","Gene")

# merge two dfs on "ID"
data <- merge(counts, anno, by.x="ID", by.y="ID", all.x=TRUE)



# write data to tsv file
write.table(data, file="WCFS1_counts.tsv", sep="\t", quote=F, row.names=F)


# set headers 
rownames(m2) <- data[,"ID"]
```


```{r}
# compute correlation
cor(m2[,1],m2[,2], method="spearman")
```
```{r}
cor(m2[,2],m2[,3], method="spearman")
```
```{r}
cor(m2[,4],m2[,5], method="spearman")
```


```{r}
cor(m2[,6],m2[,7], method="spearman")
```
```{r}
hc <- hclust(dist(t(m2), method="eu"), method= "com")
plot(hc)
```
```{r}

```
```{python}
print("hello world")
```


```{r}
# make heatmap
heatmap(m2)
```
```{r}
pr <- prcomp(m2, centre=FALSE, scale.=FALSE)


```
```{r}
summary(pr)
```
```{r}
biplot(prcomp(m2), scale=T)
```